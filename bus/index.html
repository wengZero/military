<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>專車統計</title>
	<style>
		.div_show {
			margin-top: 10px;
			width: 350px;
			display: flex;
			flex-direction: column;
			gap: 5px;
		}
		.sele_class {
			margin-top: 10px;
		}
		.debug_text {
			overflow: hidden;
			font-size: 20px;
		}
	</style>
</head>
<body>
	<p class="show">專車統計</p>
	<input class="input" type="text" maxlength="8" size="10"></input>
	<button class="btn_station">新增</button>
	<form class="sele_station"></form>
	<select class="sele_class">
		<option>選擇班級</option>
		<option value="0">1班</option>
		<option value="1">2班</option>
		<option value="2">3班</option>
		<option value="3">4班</option>
		<option value="4">5班</option>
		<option value="5">6班</option>
		<option value="6">7班</option>
		<option value="7">8班</option>
	</select>
	<form class="sele_number"></form>
	<div class="div_show">
		<textarea class="debug_text" rows="1" cols="30" readonly style="resize: none"></textarea>
		<textarea class="output" rows="20" cols="30" readonly style="resize: none" onclick="this.select()"></textarea>
	</div>
	<script>
		var military = 83
		var classes = [10, 10, 10, 10, 11, 11, 11, 10];
		var station_detail =
			[ {station_name:'斗六', station_money:180*2},
				{station_name:'西螺', station_money:200*2},
				{station_name:'虎尾', station_money:200*2},
				{station_name:'台西', station_money:240*2},
				{station_name:'北港', station_money:240*2},
				{station_name:'麥寮', station_money:250*2},
				{station_name:'嘉湯', station_money:150*2},
				{station_name:'竹崎', station_money:150*2},
				{station_name:'民雄', station_money:150*2},
				{station_name:'嘉高', station_money:200*2},
				{station_name:'水上', station_money:180*2},
				{station_name:'太保', station_money:220*2},
				{station_name:'朴子', station_money:220*2},
				{station_name:'新營', station_money:240*2}]

		const sele_class = document.querySelector(".sele_class")
		const sele_numbers = document.querySelector(".sele_number")
		const sele_station = document.querySelector(".sele_station")
		const btn_station = document.querySelector(".btn_station")
		const input = document.querySelector(".input")
		const debug_text = document.querySelector(".debug_text")
		const output = document.querySelector(".output")
		const show_text = document.querySelector(".show")

		let output_station = []
		let numbers = new Array(83).fill(0)
		let station = 0

		btn_station.addEventListener('click',()=>{
			for (let i = 0; i < output_station.length; i++) {
				if (input.value === output_station[i]) {
					debug_text.textContent = "已有重複車站名"
					return;
				}
			}
			if (input.value != "")
			{
				sele_station.innerHTML += "<input type='radio' name='station' onchange='station_onClick(this)' value='" + String(output_station.length+1) + "'>" + String(input.value)
				output_station.push(String(input.value))
				if (output_station.length % 5 === 0) sele_station.innerHTML += "<br>"
			}
			input.value = ""
			station = 0
			output_show();
		})
		sele_class.addEventListener('change',()=>{
			sele_numbers.innerHTML = ""
			let num = 1
			for (let i = 0; i < sele_class.value; i++) {
				num += classes[i];
			}
			for (let i = 0; i < classes[sele_class.value]; i++) {
				let data = num + i
				if (numbers[data-1] != 0)
					sele_numbers.innerHTML += "<input checked type='checkbox' onclick='number_onClick(this)' value='"+String(data-1)+"'>" + String(data).padStart(3, '0')
				else
					sele_numbers.innerHTML += "<input type='checkbox' onclick='number_onClick(this)' value='"+String(data-1)+"'>" + String(data).padStart(3, '0')
				if (i % 5 === 4) sele_numbers.innerHTML += "<br>"
			}
		})

		function output_show() {
			debug_text.textContent = "編輯站點: " + output_station[station-1]
			output.textContent = "步一營步一連專車統計\n\n"
			for (let i = 0; i < output_station.length; i++) {
				output.textContent += output_station[i] + ": "
				for (let j= 0; j < military; j++){
					if (numbers[j] == i+1) output.textContent += String(parseInt(j+1)).padStart(3, '0') + ", "
				}
				output.textContent += "\n\n"
			}

			output.textContent += "====================\n"
			let count = 0
			let money_count = 0
			for (let i = 0; i < output_station.length; i++) {
				let station_count = 0
				let money = null
				for (let j=0; j<station_detail.length; j++) {
					if (station_detail[j].station_name === output_station[i]) {
						money = station_detail[j].station_money
					}
				}
				for (let j=0; j < military; j++){
					if (numbers[j] == i+1) {
						station_count++;
						count++
					}
				}
				if (money != null) {
					money_count += station_count*money
					output.textContent += output_station[i] +"站("+money+"$) "+ station_count +"員("+ station_count*money +"$)\n"
				}else {
					output.textContent += output_station[i] +"站 "+ station_count +"員\n"
				}
			}
			output.textContent += "\n\n共有 " + count +"員 坐專車\n"
			output.textContent += "共 " + money_count +"元"

			let TIME = new Date()
			let str = TIME.toLocaleString('en-US', {
					hour12: false,
					month: '2-digit',
					day: '2-digit',
					hour: '2-digit',
					minute: '2-digit',
					second: '2-digit',
				})

			output.textContent += "\n\n\n統計時間 "+ str
		}
		function number_onClick(cb) {
			if (!cb.checked) {
				show_text.innerText = "已刪除 "+ String(parseInt(cb.value)+1).padStart(3, '0') + " 車站資料"
				numbers[cb.value] = 0
			}
			if (station === 0 && cb.checked) {
				debug_text.textContent = "請選擇車站名"
				return;
			}
			if (cb.checked) {
				show_text.innerText = "已新增 "+ String(parseInt(cb.value)+1).padStart(3, '0') +" 乘坐 "+output_station[station-1] +" 車站資料"
				numbers[cb.value] = station
			}
			output_show()
		}
		function station_onClick(cb) {
			station = cb.value
			output_show()
		}
	</script>
</body>
</html>